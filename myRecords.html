
<!------ Include the above in your HEAD tag ---------->

<!DOCTYPE html>
<html>
<head>





<!--Bootsrap 4 CDN-->




<!--Custom styles-->
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-app.js"></script>

<!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-analytics.js"></script>

<!-- Add Firebase products that you want to use -->
<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-firestore.js"></script>

<link rel="stylesheet" href="./style/main.css">
<link rel="stylesheet" type="text/css" href="./style/profile.css">

<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Data Tables</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
  integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
  integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
  integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
  integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="http://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
</head>


<body>

  <script src="firebaseConfig.js"></script>
  <script src="app.js"></script>






  <div class="topnav" id="myTopnav">
		<a href="main.html" class="active">Home</a>
		<a href="barcode-scanner.html">Scanner</a>
		<a href="profileInfo.html">Settings</a>
		<a href="records.html">Records</a>
        <a href="about.html">About</a>
        <a href="loggedOut.html" id='logout'>Logout</a>
		<a href="javascript:void(0);" class="icon" onclick="myFunction()">
		  <i class="fa fa-bars"></i>
		</a>
	  </div>



  <div class="container mt-5">
    <div class="row">
      <div class="col-lg-4 pb-5">
        <!-- Account Sidebar-->
        <div class="author-card pb-3">
          
          <div class="wizard">
            <nav class="list-group list-group-flush">
              <a class="list-group-item" href="profileInfo.html"><i class="fe-icon-user text-muted"></i>User details </a>
              <a class="list-group-item" href="editProfile.html">
                <div class="d-flex justify-content-between align-items-center">
                  <div><i class="fe-icon-tag mr-1 text-muted"></i>
                    <div class="d-inline-block font-weight-medium text-uppercase">Edit Profile</div>
                  </div>
                </div>
              </a>
              <a class="list-group-item" href="myRecords.html">
                <div class="d-flex justify-content-between align-items-center">
                  <div><i class="fe-icon-tag mr-1 text-muted"></i>
                    <div class="d-inline-block font-weight-medium text-uppercase">My records</div>
                  </div>
                </div>
              </a>
            </nav>
          </div>
        </div>

        <div class="containero">
          <table class="table table-fluid" id="myTable">
            <thead>
              <tr>
                <th>Photo</th>
                <th>Name</th>
                <th>Container</th>
              </tr>
            </thead>
            <tbody id="recordsBody">
    
            </tbody>
          </table>
        </div>
        
      </div>
    </div>

    <div id='wrap' class="wrapper" style="visibility: hidden;">
      <div class="product-img">
        <img id="wastePhoto" height="420" width="327">
      </div>
      <div class="product-info">
        <div class="product-text">
          <div class="row">
            <div class="col-sm-2">Name:</div>
            <div class="col-sm-10">
              <p id='name'>
                </h1>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-2">Author:</div>
            <div class="col-sm-10">
              <p id='author'>
                </h1>
            </div>
          </div>
          <div class="row120">
            <div class="col-sm-2">Container:</div>
            <div class="col-sm-10"><img id="containerPhoto"></h1>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-2">Added:</div>
            <div class="col-sm-10">
              <p id='creationDate'>
                </h2>
                </h1>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-2">Rating:</div>
            <div class="col-sm-10">
              <p id="lajki"></p>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-6"><button id="confirmButton" class="btn btn-outline-success">Confirm</button></div>
            <div class="col-sm-6"><button id="denyButton" class="btn btn-outline-danger">Deny</button> </div>
          </div>
        </div>
      </div>


    
    <!-- Link to open the modal -->

    <script>





      var firestore = firebase.firestore();
      window.setTimeout(getDatas, 2000);//add this line for timer with ur function for load datas
      const wrapper = document.querySelector("#wrapper");
      const detailWastePhoto = document.querySelector("#wastePhoto");
      const detailName = document.querySelector("#name");
      const detailAuthor = document.querySelector("#author");
      const detailCreationDate = document.querySelector("#creationDate");
      const detailLikes = document.querySelector("#lajki");
      const detailContainer = document.querySelector('#wrap');
      const detailContainerPhoto = document.querySelector('#containerPhoto');
      const searchBarCode = document.querySelector("#searchForMe");
      const recordsTable = document.querySelector(".containero");


      function fillTable() {
        console.log("startuje");

        firestore.collection('products').get().then((snapshot) => {
          snapshot.docs.forEach(doc => {
            renderRecordsList(doc);
          })
        }).then(function () {
          console.log("All record have been loaded");
        }).catch(function (error) {
          console.log("got an error: ", error);
        });
      }

      // output.innerText="";


      const recordsList = document.querySelector('#myTable');
      const recordsBody = document.querySelector('#recordsBody');
      
      console.log(recordsList);
      function renderRecordsList(doc) {
        let currentUser = firebase.auth().currentUser;
      

        if(currentUser.displayName != doc.data().author){
        } else{
        // if (  currentUserID !== doc.data().userID ) {

        let tr = document.createElement('tr');
        let td_wastePhoto = document.createElement('td');
        let td_name = document.createElement('td');
        let td_wasteContainer = document.createElement('td');
        let td_buttons = document.createElement('td');
        let td_img = document.createElement("img");
        let td_img2 = document.createElement("img");
        let removal = document.createElement("button");
        let edit = document.createElement("button");
        let clickable = document.createElement("a");


        tr.style.width = '10%';
        td_img.style.height = '100px';
        td_img.style.width = '100px';



        tr.setAttribute('data-id', doc.id);
        td_name.textContent = doc.data().name;
        td_wasteContainer.src = doc.data().binURL;
        // td_wasteContainer.innerHTML += "<section> <span class= 'trash'> <span></span> <i></i></span> </section>";
        td_img.src = doc.data().photoURL;
        td_img2.src = doc.data().binURL;
        td_wasteContainer.appendChild(td_img2);
        td_wastePhoto.appendChild(clickable);
        td_buttons.appendChild(removal);
        clickable.appendChild(td_img);

        
       clickable.addEventListener("click", function(){
        recordsTable.style.display=""
        //wrapper.parentNode.removeChild(wrapper);
        //document.getElementById("wrap").outerHTML = "";

        showDetail(doc);
       


      })

        // td_buttons.appendChild(edit);
        // td_buttons.style.height="200px";


        tr.appendChild(td_wastePhoto);
        tr.appendChild(td_name);
        tr.appendChild(td_wasteContainer);
        //  tr.appendChild(td_buttons);


        recordsBody.appendChild(tr);

      }
    }

      //}



      window.addEventListener("load", function () {
        fillTable();
      })

      function getDatas() {
        $('#myTable').DataTable();

      }

      function showDetail(doc) {
        const myData = doc.data();
        // var showName = document.createElement("p");
        detailName.innerHTML = myData.name;

        // var showAuthor = document.createElement("p");
        detailAuthor.innerHTML = myData.author;

        // var showAddingDate = document.createElement("p");
        detailCreationDate.innerHTML = myData.addingDate;

        // var showWastePhoto = document.createElement("img");
        detailWastePhoto.src = myData.photoURL;
        detailContainerPhoto.src = assignContainerPhoto(doc);
        detailContainer.style.visibility = 'visible';
        recordsTable.style.display="none";

        detailLikes.innerHTML = myData.confirmation;


        var showContainer = document.createElement("img");
        showContainer.src = assignContainerPhoto(doc);


        

      }


      function assignContainerPhoto(doc) {
        var myData = doc.data();

        if (myData.wasteContainer == "green") {
          binURL = "https://firebasestorage.googleapis.com/v0/b/trasher-92594.appspot.com/o/gs%3A%2Ftrasher-92594.appspot.com%2Fbins%2Fgreen.png?alt=media&token=fed5248e-34dc-46b5-9dc8-9a404b4949f5";
        }
        else if (myData.wasteContainer == "blue") {
          binURL = "https://firebasestorage.googleapis.com/v0/b/trasher-92594.appspot.com/o/gs%3A%2Ftrasher-92594.appspot.com%2Fbins%2Fblue.png?alt=media&token=a3f9dc88-e69d-4c55-8a45-203a8f77139b";
        }
        else if (myData.wasteContainer == "black") {
          binURL = "https://firebasestorage.googleapis.com/v0/b/trasher-92594.appspot.com/o/gs%3A%2Ftrasher-92594.appspot.com%2Fbins%2Fblack.png?alt=media&token=0839165d-f42b-4b7d-a79f-642bba9533ca";
        }
        else if (myData.wasteContainer == "yellow") {
          binURL = "https://firebasestorage.googleapis.com/v0/b/trasher-92594.appspot.com/o/gs%3A%2Ftrasher-92594.appspot.com%2Fbins%2Fyellow.png?alt=media&token=516dce0c-67d3-4a30-8b35-42eb4b0dde83"
        }
        else if (myData.wasteContainer == "red") {
          binURL = "https://firebasestorage.googleapis.com/v0/b/trasher-92594.appspot.com/o/gs%3A%2Ftrasher-92594.appspot.com%2Fbins%2Fred.png?alt=media&token=b8e8d83f-1ea5-40d7-8c12-736a481cf3ab";
        }
        return binURL;
      }
      
      confirmButton.addEventListener("click", function () {
        const docRef = firestore.doc("products/" + searchBarCode.value);
        docRef.get().then(function (doc) {
          if (doc && doc.exists) {
            const myData = doc.data();
            docRef.update({
              confirmation: firebase.firestore.FieldValue.increment(1),
            })
            window.location.href = "rated.html";

            console.log(myData.confirmation)
            if (myData.confirmation > 3) {
              hideConfirmationButtons();
            } else {
              console.log("printuje tutaj" + myData.confirmation)
            }
          }
        })
      });

      denyButton.addEventListener("click", function () {
        var checker;
        const docRef = firestore.doc("products/" + searchBarCode.value);
        docRef.get().then(function (doc) {
          if (doc && doc.exists) {
            const myData = doc.data();
            checker = myData.confirmation,
              docRef.update({
                confirmation: firebase.firestore.FieldValue.increment(-1),
              })

            window.location.href = "rated.html";

            console.log(myData.confirmation)
            if (myData.confirmation < -3) {
              hideConfirmationButtons();
            }
            if (checker == -4) {
              console.log(checker + " to jest wartosc checkera")
              docRef.delete().then(function () {
                alert("This record is being deleted due to multiple denies")
                console.log("Document successfully deleted!");
                window.location.replace("records.html")
              }).catch(function (error) {
                console.error("Error removing document: ", error);
              });
            }
          }
        });
      })



      
    </script>


</body>

</html>